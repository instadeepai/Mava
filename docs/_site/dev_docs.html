<!DOCTYPE html>
<html>
<link rel="icon" href="/favicon.png">

<head>


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Multi-Agent Reinforcement Learning Environments">
  <meta name="author" content="Your Name">
  <link rel="canonical" href="http://localhost:4000/dev_docs.html">

  <title>Developer Documentation | Mava</title>

  <!-- Bootstrap core CSS -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/assets/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet'
    type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@900&display=swap" rel="stylesheet">

  <!-- Custom styles for this theme -->
  <link href="/assets/css/markdown_format.css" rel="stylesheet">
  <link href="/assets/css/highlighting.css" rel="stylesheet">
  <!--<link href="/assets/css/agency.min.css" rel="stylesheet">-->
  <link href="/assets/css/agency.css" rel="stylesheet">
  <!--<script src="/assets/js/particles.js"></script>-->

</head>


<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav" style="background-color:#212529">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="/#"><img height="100" src="/assets/img/mava_logo_icon.jpg" /></a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
        data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
        aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav text-uppercase ml-auto">
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/overview">Overview</a></li>
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/envs">Components</a></li>
          <li class="nav-item"><a class="nav-link js-scroll-trigger"
              href="https://github.com/instadeepai/Mava">Github</a></li>

          <!-- Navigation -->
          <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav" style="background-color:#212529">
            <div class="container">
              <a class="navbar-brand js-scroll-trigger" href="/#"><img height="100" src="/assets/img/mava.png" /></a>
              <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
              </button>
              <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav text-uppercase ml-auto">
                  <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/overview">Overview</a></li>
                  <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/envs">Components</a></li>
                  <li class="nav-item"><a class="nav-link js-scroll-trigger"
                      href="https://github.com/arnupretorius/mava">Github</a></li>

                </ul>
              </div>
            </div>
          </nav>
          <!-- End Navigation -->


          <header></header>

          <section class="page-section">
            <div class="docnavcontainer">
              <div class="row environment-bar">
                <div class="col docnavi">
                  <a href="/architectures"> Architectures</a>
                </div>
                <div class="col docnavi">
                  <a href="/modules"> Modules</a>
                </div>
                <div class="col docnavi">
                  <a href="/networks"> Networks</a>
                </div>
                <div class="col docnavi">
                  <a href="/losses"> Losses</a>
                </div>
              </div>
            </div>
          </section>


          <div class="doccontainer container" id="pagecontainer">
            <div class="markdown-body">
              <h1 id="developer-documentation">Developer Documentation</h1>

              <p>This documentation overviews creating new environments and relevant useful wrappers, utilities and
                tests
                included in PettingZoo designed for the creation of new environments.</p>

              <h2 id="example-custom-environment">Example Custom Environment</h2>

              <p>This is a carefully commented version of the PettingZoo rock paper scissors environment.</p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code><span class="kn">from</span> <span class="nn">gym.spaces</span> <span class="kn">import</span> <span class="n">Discrete</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">pettingzoo</span> <span class="kn">import</span> <span class="n">AECEnv</span>
<span class="kn">from</span> <span class="nn">pettingzoo.utils</span> <span class="kn">import</span> <span class="n">agent_selector</span>
<span class="kn">from</span> <span class="nn">pettingzoo.utils</span> <span class="kn">import</span> <span class="n">wrappers</span>


<span class="n">ROCK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PAPER</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SCISSORS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">NONE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">MOVES</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ROCK"</span><span class="p">,</span> <span class="s">"PAPER"</span><span class="p">,</span> <span class="s">"SCISSORS"</span><span class="p">,</span> <span class="s">"None"</span><span class="p">]</span>
<span class="n">NUM_ITERS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">REWARD_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">env</span><span class="p">():</span>
    <span class="s">"""
    The env function wraps the environment in 3 wrappers by default. These
    wrappers contain logic that is common to many pettingzoo environments.
    We recomend you use at least the OrderEnforcingWrapper on your own environment
    to provide sane error messages. You can find full documentation for these methods
    elsewhere in the developer documentation.
    """</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">raw_env</span><span class="p">()</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">CaptureStdoutWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">AssertOutOfBoundsWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">OrderEnforcingWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span>


<span class="k">class</span> <span class="nc">raw_env</span><span class="p">(</span><span class="n">AECEnv</span><span class="p">):</span>
    <span class="s">"""
    The metadata holds environment constants. From gym, we inherit the "render.modes",
    metadata which specifies which modes can be put into the render() method.
    At least human mode should be supported.
    The "name" metadata allows the environment to be pretty printed.
    """</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s">"render.modes"</span><span class="p">:</span> <span class="p">[</span><span class="s">"human"</span><span class="p">],</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"rps_v1"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        The init method takes in environment arguments and
         should define the following attributes:
        - possible_agents
        - action_spaces
        - observation_spaces

        These attributes should not be changed after initialization.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s">"player_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">))))</span>
        <span class="p">)</span>

        <span class="c1"># Gym spaces are defined and documented here: https://gym.openai.com/docs/#spaces
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">Discrete</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">Discrete</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"human"</span><span class="p">):</span>
        <span class="s">"""
        Renders the environment. In human mode, it can print to terminal, open
        up a graphical window, or open up some other display that a human can see and understand.
        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s">"Current state: Agent1: {} , Agent2: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
                <span class="n">MOVES</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]]],</span> <span class="n">MOVES</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s">"Game over"</span>
        <span class="k">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
        <span class="s">"""
        Observe should return the observation of the specified agent. This function
        should return a sane observation (though not necessarily the most up to date possible)
        at any time after reset() is called.
        """</span>
        <span class="c1"># observation of one agent is the previous state of the other
</span>        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">observations</span><span class="p">[</span><span class="n">agent</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Close should release any graphical displays, subprocesses, network connections
        or any other environment data which should not be kept around after the
        user is no longer using the environment.
        """</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Reset needs to initialize the following attributes
        - agents
        - rewards
        - _cumulative_rewards
        - dones
        - infos
        - agent_selection
        And must set up the environment so that render(), step(), and observe()
        can be called without issues.

        Here it sets up the state dictionary which is used by step() and the observations dictionary which is used by step() and observe()
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">agents</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_cumulative_rewards</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dones</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="bp">False</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">NONE</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">observations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">NONE</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="s">"""
        Our agent_selector utility allows easy cyclic stepping through the agents list.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_agent_selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_agent_selector</span><span class="p">.</span><span class="nb">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="s">"""
        step(action) takes in an action for the current agent (specified by
        agent_selection) and needs to update
        - rewards
        - _cumulative_rewards (accumulating the rewards)
        - dones
        - infos
        - agent_selection (to the next agent)
        And any internal state used by observe() or render()
        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">dones</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agent_selection</span><span class="p">]:</span>
            <span class="c1"># handles stepping an agent which is already done
</span>            <span class="c1"># accepts a None action for the one agent, and moves the agent_selection to
</span>            <span class="c1"># the next done agent,  or if there are no more done agents, to the next live agent
</span>            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_was_done_step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">agent_selection</span>

        <span class="c1"># the agent which stepped last had its _cumulative_rewards accounted for
</span>        <span class="c1"># (because it was returned by last()), so the _cumulative_rewards for this
</span>        <span class="c1"># agent should start again at 0
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_cumulative_rewards</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># stores action of current agent
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agent_selection</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>

        <span class="c1"># collect reward if it is the last agent to act
</span>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">_agent_selector</span><span class="p">.</span><span class="n">is_last</span><span class="p">():</span>
            <span class="c1"># rewards for all agents are placed in the .rewards dictionary
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="p">.</span><span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">REWARD_MAP</span><span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># The dones dictionary must be updated for all players.
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">dones</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">&gt;=</span> <span class="n">NUM_ITERS</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>

            <span class="c1"># observe the current state
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">observations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">agent_name_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># necessary so that observe() returns a reasonable observation at all times.
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">agent_name_mapping</span><span class="p">[</span><span class="n">agent</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">NONE</span>
            <span class="c1"># no rewards are allocated until both players give an action
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_clear_rewards</span><span class="p">()</span>

        <span class="c1"># selects the next agent.
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">agent_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_agent_selector</span><span class="p">.</span><span class="nb">next</span><span class="p">()</span>
        <span class="c1"># Adds .rewards to ._cumulative_rewards
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_accumulate_rewards</span><span class="p">()</span>
</code></pre>
                </div>
              </div>

              <h2 id="example-custom-parallel-environment">Example Custom Parallel Environment</h2>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code><span class="kn">from</span> <span class="nn">gym.spaces</span> <span class="kn">import</span> <span class="n">Discrete</span>
<span class="kn">from</span> <span class="nn">pettingzoo</span> <span class="kn">import</span> <span class="n">ParallelEnv</span>
<span class="kn">from</span> <span class="nn">pettingzoo.utils</span> <span class="kn">import</span> <span class="n">wrappers</span>
<span class="kn">from</span> <span class="nn">pettingzoo.utils</span> <span class="kn">import</span> <span class="n">from_parallel</span>


<span class="n">ROCK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PAPER</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SCISSORS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">NONE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">MOVES</span> <span class="o">=</span> <span class="p">[</span><span class="s">"ROCK"</span><span class="p">,</span> <span class="s">"PAPER"</span><span class="p">,</span> <span class="s">"SCISSORS"</span><span class="p">,</span> <span class="s">"None"</span><span class="p">]</span>
<span class="n">NUM_ITERS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">REWARD_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ROCK</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PAPER</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">ROCK</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">PAPER</span><span class="p">):</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SCISSORS</span><span class="p">,</span> <span class="n">SCISSORS</span><span class="p">):</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">env</span><span class="p">():</span>
    <span class="s">"""
    The env function wraps the environment in 3 wrappers by default. These
    wrappers contain logic that is common to many pettingzoo environments.
    We recomend you use at least the OrderEnforcingWrapper on your own environment
    to provide sane error messages. You can find full documentation for these methods
    elsewhere in the developer documentation.
    """</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">raw_env</span><span class="p">()</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">CaptureStdoutWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">AssertOutOfBoundsWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">wrappers</span><span class="p">.</span><span class="n">OrderEnforcingWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span>


<span class="k">def</span> <span class="nf">raw_env</span><span class="p">():</span>
    <span class="s">"""
    To support the AEC API, the raw_env() function just uses the from_parallel
    function to convert from a ParallelEnv to an AEC env
    """</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">parallel_env</span><span class="p">()</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">from_parallel</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">env</span>


<span class="k">class</span> <span class="nc">parallel_env</span><span class="p">(</span><span class="n">ParallelEnv</span><span class="p">):</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s">"render.modes"</span><span class="p">:</span> <span class="p">[</span><span class="s">"human"</span><span class="p">],</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"rps_v1"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        The init method takes in environment arguments and should define the following attributes:
        - possible_agents
        - action_spaces
        - observation_spaces

        These attributes should not be changed after initialization.
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s">"player_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">agent_name_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">))))</span>
        <span class="p">)</span>

        <span class="c1"># Gym spaces are defined and documented here: https://gym.openai.com/docs/#spaces
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">action_spaces</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">Discrete</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">observation_spaces</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">Discrete</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"human"</span><span class="p">):</span>
        <span class="s">"""
        Renders the environment. In human mode, it can print to terminal, open
        up a graphical window, or open up some other display that a human can see and understand.
        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s">"Current state: Agent1: {} , Agent2: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
                <span class="n">MOVES</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]]],</span> <span class="n">MOVES</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s">"Game over"</span>
        <span class="k">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Close should release any graphical displays, subprocesses, network connections
        or any other environment data which should not be kept around after the
        user is no longer using the environment.
        """</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Reset needs to initialize the `agents` attribute and must set up the
        environment so that render(), and step() can be called without issues.

        Here it initializes the `num_moves` variable which counts the number of
        hands that are played.

        Returns the observations for each agent
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">agents</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">possible_agents</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">NONE</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">observations</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="s">"""
        step(action) takes in an action for each agent and should return the
        - observations
        - rewards
        - dones
        - infos
        dicts where each dict looks like {agent_1: item_1, agent_2: item_2}
        """</span>
        <span class="c1"># If a user passes in actions with no agents, then just return empty observations, etc.
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="c1"># rewards for all agents are placed in the rewards dictionary to be returned
</span>        <span class="n">rewards</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">REWARD_MAP</span><span class="p">[</span>
            <span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">env_done</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">num_moves</span> <span class="o">&gt;=</span> <span class="n">NUM_ITERS</span>
        <span class="n">dones</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="n">env_done</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>

        <span class="c1"># current observation is just the other player's most recent action
</span>        <span class="n">observations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1"># typically there won't be any information in the infos, but there must
</span>        <span class="c1"># still be an entry for each agent
</span>        <span class="n">infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">agents</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">observations</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">infos</span>
</code></pre>
                </div>
              </div>

              <h2 id="wrappers">Wrappers</h2>

              <p>A wrapper is an environment transformation that takes in an environment as input, and outputs a new
                environment
                that is similar to the input environment, but with some transformation or validation applied.</p>

              <h3 id="conversion-wrappers">Conversion wrappers</h3>

              <p>As we provide both the AEC API and the Parallel API, we also provide wrappers to convert environments
                back and
                forth between the two APIs.</p>

              <h4 id="aec-to-parallel">AEC to Parallel</h4>

              <p>An environment can be converted from an AEC environment to a parallel environment with the <code
                  class="language-plaintext highlighter-rouge">to_parallel</code> wrapper shown below. Note that this
                wrapper
                makes the following assumptions about the underlying environment:</p>

              <ol>
                <li>The environment steps in a cycle, i.e. it steps through every live agent in order.</li>
                <li>The environment does not update the observations of the agents except at the end of a cycle.</li>
              </ol>

              <p>Most parallel environments in PettingZoo only allocate rewards at the end of a cycle. In these
                environments,
                the reward scheme of the AEC API an the parallel API is equivalent. If an AEC environment does allocate
                rewards
                within a cycle, then the rewards will be allocated at different timesteps in the AEC environment an the
                Parallel
                environment. In particular, the AEC environment will allocate all rewards from one time the agent steps
                to the
                next time, while the Parallel environment will allocate all rewards from when the first agent stepped to
                the
                last agent stepped.</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.utils import to_parallel
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
env = to_parallel(env)
</code></pre>
                </div>
              </div>

              <h4 id="parallel-to-aec">Parallel to AEC</h4>

              <p>Any parallel environment can be efficiently converted to an AEC environment with the <code
                  class="language-plaintext highlighter-rouge">from_parallel</code> wrapper.</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.utils import from_parallel
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.parallel_env()
env = from_parallel(env)
</code></pre>
                </div>
              </div>

              <h3 id="utility-wrappers">Utility Wrappers</h3>

              <p>We wanted our pettingzoo environments to be both easy to use and easy to implement. To combine these,
                we have a
                set of simple wrappers which provide input validation and other convenient reusable logic.</p>

              <ul>
                <li><code class="language-plaintext highlighter-rouge">BaseWrapper</code>: All AECEnv wrappers should
                  inherit
                  from this base class</li>
                <li><code class="language-plaintext highlighter-rouge">TerminateIllegalWrapper</code>: Handles illegal
                  move
                  logic for classic games</li>
                <li><code class="language-plaintext highlighter-rouge">CaptureStdoutWrapper</code>: Takes an environment
                  which
                  prints to terminal, and gives it an <code class="language-plaintext highlighter-rouge">ansi</code>
                  render mode
                  where it captures the terminal output and returns it as a string instead.</li>
                <li><code class="language-plaintext highlighter-rouge">AssertOutOfBoundsWrapper</code>: Asserts if the
                  action
                  given to step is outside of the action space. Applied in PettingZoo environments with discrete action
                  spaces.
                </li>
                <li><code class="language-plaintext highlighter-rouge">ClipOutOfBoundsWrapper</code>: Clips the input
                  action to
                  fit in the continuous action space (emitting a warning if it does so). Applied to continuous
                  environments in
                  pettingzoo.</li>
                <li><code class="language-plaintext highlighter-rouge">OrderEnforcingWrapper</code>: Gives a sensible
                  error
                  message if function calls or attribute access are in a disallowed order, for example if step() is
                  called
                  before reset(), or the .dones attribute is accessed before reset(), or if seed() is called and then
                  step() is
                  used before reset() is called again (reset must be called after seed()). Applied to all PettingZoo
                  environments.</li>
              </ul>

              <p>You can apply these wrappers to your environment in a similar manner to the below example:</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.utils import OrderEnforcingWrapper
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
env = OrderEnforcingWrapper(env)
</code></pre>
                </div>
              </div>

              <h2 id="developer-utils">Developer Utils</h2>

              <p>The utils directory contains a few functions which are helpful for debugging environments. These are
                documented
                in the API docs.</p>

              <p>The utils directory also contain some classes which are only helpful for developing new environments.
                These are
                documented below.</p>

              <h3 id="agent-selector">Agent selector</h3>

              <p>The <code class="language-plaintext highlighter-rouge">agent_selector</code> class steps through agents
                in a
                cycle</p>

              <p>It can be used as follows to cycle through the list of agents:</p>

              <div class="language-python highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code><span class="kn">from</span> <span class="nn">pettingzoo.utils</span> <span class="kn">import</span> <span class="n">agent_selector</span>

<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="s">"agent_1"</span><span class="p">,</span> <span class="s">"agent_2"</span><span class="p">,</span> <span class="s">"agent_3"</span><span class="p">]</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">agent_selector</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span>
<span class="n">agent_selection</span> <span class="o">=</span> <span class="n">selector</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>
<span class="c1"># agent_selection will be "agent_1"
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">agent_selection</span> <span class="o">=</span> <span class="n">selector</span><span class="p">.</span><span class="nb">next</span><span class="p">()</span>
    <span class="c1"># will select "agent_2", "agent_3", "agent_1", "agent_2", "agent_3", ..."
</span></code></pre>
                </div>
              </div>

              <h3 id="deprecated-module">Deprecated Module</h3>

              <p>The DeprecatedModule is used in PettingZoo to help guide the user away from old obsolete environment
                versions
                and toward new ones. If you wish to create a similar versioning system, this may be helpful.</p>

              <p>For example, when the user tries to import the <code
                  class="language-plaintext highlighter-rouge">prospector_v0</code> environment, they import the
                following
                variable (defined in <code
                  class="language-plaintext highlighter-rouge">pettingzoo/butterfly/__init__.py</code>):</p>
              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.utils.deprecated_module import DeprecatedModule
prospector_v0 = DeprecatedModule("prospector", "v0", "v3")
</code></pre>
                </div>
              </div>
              <p>This declaration tells the user that <code
                  class="language-plaintext highlighter-rouge">prospector_v0</code> is
                deprecated and <code class="language-plaintext highlighter-rouge">prospector_v4</code> should be used
                instead.
                In particular, it gives the following error:</p>
              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.butterfly import prospector_v0
prospector_v0.env()
# pettingzoo.utils.deprecated_module.DeprecatedEnv: prospector_v0 is now deprecated, use prospector_v4 instead
</code></pre>
                </div>
              </div>

              <h2 id="tests">Tests</h2>

              <p>PettingZoo has a number of compliance tests for environments through. If you are adding a new
                environment, we
                encourage you to run these tests on your own environment.</p>

              <h3 id="api-test">API Test</h3>

              <p>PettingZoos API has a number of features and requirements. To make sure your environment is consistent
                with
                the API, we have the api_test. Below is an example:</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import api_test
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
api_test(env, num_cycles=10, verbose_progress=False)
</code></pre>
                </div>
              </div>

              <p>As you can tell, you simply pass an environment to the test. The test will assert or give some other
                error on
                an API issue, and will return normally if it passes.</p>

              <p>The optional arguments are:</p>

              <ul>
                <li><code class="language-plaintext highlighter-rouge">num_cycles</code>: runs the environment for that
                  many
                  cycles and checks that the output is consistent with the API.</li>
                <li><code class="language-plaintext highlighter-rouge">verbose_progress</code>: Prints out messages to
                  indicate
                  partial completion of the test. Useful for debugging environments.</li>
              </ul>

              <h3 id="parallel-api-test">Parallel API Test</h3>

              <p>This is an analogous version of the API test, but for parallel environments. You can use this test
                like:</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import parallel_api_test
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.parallel_env()
parallel_api_test(env, num_cycles=10)
</code></pre>
                </div>
              </div>

              <h3 id="seed-test">Seed Test</h3>

              <p>To have a properly reproducible environment that utilizes randomness, you need to be able to make it
                deterministic during evaluation by setting a seed for the random number generator that defines the
                random
                behavior. The seed test checks that calling the <code
                  class="language-plaintext highlighter-rouge">seed()</code>
                method with a constant actually makes the environment deterministic.</p>

              <p>The seed test takes in a function that creates a pettingzoo environment. For example</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import seed_test
from pettingzoo.butterfly import pistonball_v4
env_fn = pistonball_v4.env
seed_test(env_fn, num_cycles=10)
</code></pre>
                </div>
              </div>

              <p>The optional argument, <code class="language-plaintext highlighter-rouge">num_cycles</code>, indicates
                how long
                the environment will be run to check for determinism. Some environments only fail the test long after
                initialization.</p>

              <h3 id="max-cycles-test">Max Cycles Test</h3>

              <p>The max cycles test tests that the <code class="language-plaintext highlighter-rouge">max_cycles</code>
                environment argument exists and the resulting environment actually runs for the correct number of
                cycles. If
                your environment does not take a <code class="language-plaintext highlighter-rouge">max_cycles</code>
                argument,
                you should not run this test. The reason this test exists is that many off-by-one errors are possible
                when
                implementing <code class="language-plaintext highlighter-rouge">max_cycles</code>. An example test usage
                looks
                like:</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import max_cycles_test
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
max_cycles_test(env)
</code></pre>
                </div>
              </div>

              <h3 id="render-test">Render Test</h3>

              <p>The render test checks that rendering 1) does not crash and 2) produces output of the correct type when
                given a
                mode. The render test supports testing <code
                  class="language-plaintext highlighter-rouge">'human'</code>, <code
                  class="language-plaintext highlighter-rouge">'ansi'</code>, and <code
                  class="language-plaintext highlighter-rouge">'rgb_array'</code> modes.</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import render_test
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
render_test(env)
</code></pre>
                </div>
              </div>

              <h3 id="performance-benchmark-test">Performance Benchmark Test</h3>

              <p>To make sure we do not have performance regressions, we have the performance benchmark test. This test
                simply
                prints out the number of steps and cycles that the environment takes in 5 seconds. This test requires
                manual
                inspection of its outputs:</p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import performance_benchmark
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
performance_benchmark(env)
</code></pre>
                </div>
              </div>

              <h3 id="save-observation-test">Save Observation Test</h3>

              <p>The save observation test is to visually inspect the observations of games with graphical observations
                to make
                sure they are what is intended. We have found that observations are a huge source of bugs in
                environments, so it
                is good to manually check them when possible. This test just tries to save the observations of all the
                agents.
                If it fails, then it just prints a warning. The output needs to be visually inspected for correctness.
              </p>

              <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre class="highlight"><code>from pettingzoo.test import test_save_obs
from pettingzoo.butterfly import pistonball_v4
env = pistonball_v4.env()
test_save_obs(env)
</code></pre>
                </div>
              </div>

            </div>
          </div>


          <!-- Footer -->
          <footer class="footer" id="footer" style="background-color:white;">
            <div class="container">
              <div class="row">
                <div class="col-md">
                  <span class="copyright">Copyright &copy; [...placeholder...] 2021</span>
                </div>
                <!-- Social Media -->
                <!-- Legal -->
              </div>
            </div>
          </footer>

          <!-- End Footer -->



          <!-- Bootstrap core JavaScript -->
          <script src="/assets/js/jquery.min.js"></script>
          <script src="/assets/js/bootstrap.bundle.min.js"></script>

          <!-- Plugin JavaScript -->
          <script src="/assets/js/jquery.easing.min.js"></script>

          <!-- Contact form JavaScript -->
          <script src="/assets/js/jqBootstrapValidation.js"></script>
          <script src="/assets/js/contact_me.js"></script>

          <!-- Custom scripts for this template -->
          <script src="/assets/js/agency.min.js"></script>
          <script src="/assets/js/app.js"></script>

</body>

</html>